<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.spacecore.mapper.chatbot.ChatbotMapper">
    <resultMap id="chatbotMap" type="com.spacecore.domain.chatbot.Chatbot">
        <id property="id" column="id" />
        <result property="question" column="question" />
        <result property="answer" column="answer" />
        <result property="category" column="category" />
        <result property="priority" column="priority" />
        <result property="createdAt" column="created_at" />
    </resultMap>

    <!-- 챗봇 데이터 생성(FAQ) (관리자용) -->
    <insert id="insertChatbot" parameterType="com.spacecore.domain.chatbot.Chatbot">
        <selectKey keyProperty="id" resultType="long" order="BEFORE">
            SELECT seq_chatbot_id.NEXTVAL FROM dual
        </selectKey>
        INSERT INTO chatbot (id, question, answer, category, priority, created_at)
        VALUES (#{id}, #{question}, #{answer}, #{category}, #{priority}, SYSTIMESTAMP)
    </insert>

    <!-- 챗봇 전체 목록 조회 (관라지 또는 전체 목록 페이지용) / priority 순으로 정렬하여 반환 -->
    <select id="selectAllChatbots" resultMap="chatbotMap">
        SELECT *
        FROM chatbot
        ORDER BY priority, created_at DESC
    </select>

    <!-- 특정 카테고리에 해당하는 FAQ 목록 조회 (사용자 페이지용) -->
    <select id="selectChatbotByCategory" resultMap="chatbotMap">
        SELECT *
        FROM chatbot
        WHERE category = #{category}
        ORDER BY priority, created_at DESC
    </select>

    <!-- 특정 FAQ 데이터 조회 (수정 또는 상세보기용) -->
    <select id="selectChatbotById" resultMap="chatbotMap">
        SELECT *
        FROM chatbot
        WHERE id = #{id}
    </select>

    <!-- FAQ 데이터 수정 (관리자용) -->
    <update id="updateChatbot" parameterType="com.spacecore.domain.chatbot.Chatbot">
        UPDATE chatbot
        SET question = #{question},
            answer = #{answer},
            category = #{category},
            priority = #{priority}
        WHERE id = #{id}
    </update>

    <!-- FAQ 데이터 삭제 (관리자용) -->
    <delete id="deleteChatbot" parameterType="long">
        DELETE FROM chatbot
        WHERE id = #{id}
    </delete>
</mapper>